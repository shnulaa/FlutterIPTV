# Catchup åŠŸèƒ½å®ç°æ€»ç»“

## é—®é¢˜ 1ï¼šæ–‡æ¡£æ˜¯å¦ä½“ç°äº†æ‰€æœ‰é…ç½®æ–¹å¼ï¼Ÿ

âœ… **å·²å®Œæ•´ä½“ç°**ï¼Œæ–‡æ¡£ç°åœ¨åŒ…å«ï¼š

### å…¨å±€é…ç½®ï¼ˆç¬¬ 2.1 èŠ‚ï¼‰
```m3u
#EXTM3U catchup="append" catchup-source="?playbackbegin=${(b)yyyyMMddHHmmss}&playbackend=${(e)yyyyMMddHHmmss}"
```

### å•ä¸ªé¢‘é“é…ç½®ï¼ˆç¬¬ 2.1 èŠ‚ï¼‰

**Append æ¨¡å¼ï¼š**
```m3u
#EXTINF:-1 catchup="append" catchup-source="?playseek=${(b)yyyyMMddHHmmss}-${(e)yyyyMMddHHmmss}",CCTV1
http://hostname:port/xxx
```

**Default æ¨¡å¼ï¼ˆç‹¬ç«‹å›çœ‹åœ°å€ï¼‰ï¼š**
```m3u
#EXTINF:-1 catchup="default" catchup-source="http://hostname:port/xxx2?playseek=${(b)yyyyMMddHHmmss}-${(e)yyyyMMddHHmmss}",CCTV1
http://hostname:port/xxx
```

### UTC æ—¶é—´å‚æ•°ï¼ˆç¬¬ 2.3 èŠ‚ï¼‰

**æ ¼å¼ 1ï¼š**
```m3u
#EXTINF:-1 catchup="append" catchup-source="?playseek=${(b)yyyyMMddHHmmss:utc}-${(e)yyyyMMddHHmmss:utc}",CCTV1
```

**æ ¼å¼ 2ï¼š**
```m3u
#EXTINF:-1 catchup="append" catchup-source="?playseek={utc:YmdHMS}-{utcend:YmdHMS}",CCTV1
```

### æ—¶é—´æˆ³æ ¼å¼ï¼ˆç¬¬ 2.3 èŠ‚ï¼‰
```m3u
#EXTM3U catchup="append" catchup-source="?starttime=${(b)timestamp}&endtime=${(e)timestamp}"
```

### å®Œæ•´ç¤ºä¾‹ï¼ˆç¬¬ 2.4 èŠ‚ï¼‰
æä¾›äº†å¤šä¸ªçœŸå®åœºæ™¯çš„å®Œæ•´é…ç½®ç¤ºä¾‹ã€‚

---

## é—®é¢˜ 2ï¼šæ’­æ”¾é¡µé¢å¦‚ä½•äº¤äº’ï¼Ÿ

âœ… **å·²è¯¦ç»†è®¾è®¡**ï¼Œå‚è§æ–‡æ¡£ç¬¬ 5.4 èŠ‚ã€Šæ’­æ”¾é¡µé¢äº¤äº’è¯¦ç»†è®¾è®¡ã€‹


### æ ¸å¿ƒäº¤äº’æµç¨‹

#### 1. è¿›å…¥å›çœ‹æ¨¡å¼
```
ç›´æ’­æ’­æ”¾ä¸­ â†’ ç‚¹å‡»"ğŸ“º å›çœ‹"æ ‡ç­¾ â†’ æ£€æŸ¥ Catchup æ”¯æŒ 
â†’ åŠ è½½ EPG æ•°æ® â†’ æ˜¾ç¤ºæ—¶é—´è½´å’ŒèŠ‚ç›®åˆ—è¡¨
```

#### 2. é€‰æ‹©å†å²èŠ‚ç›®ï¼ˆä¸‰ç§æ–¹å¼ï¼‰

**æ–¹å¼ Aï¼šæ—¶é—´è½´äº¤äº’**
- å·¦å³æ»‘åŠ¨æµè§ˆä¸åŒæ—¶é—´æ®µ
- ç‚¹å‡»èŠ‚ç›®å—æŸ¥çœ‹è¯¦æƒ…
- ç‚¹å‡»"æ’­æ”¾"æŒ‰é’®å¼€å§‹å›çœ‹

**æ–¹å¼ Bï¼šèŠ‚ç›®åˆ—è¡¨**
- æ»šåŠ¨æµè§ˆèŠ‚ç›®åˆ—è¡¨
- ç›´æ¥ç‚¹å‡»èŠ‚ç›®é¡¹å¼€å§‹æ’­æ”¾

**æ–¹å¼ Cï¼šæ—¥æœŸé€‰æ‹©**
- ç‚¹å‡»æ—¥æœŸç®­å¤´åˆ‡æ¢æ—¥æœŸ
- æˆ–æ‰“å¼€æ—¥å†é€‰æ‹©å…·ä½“æ—¥æœŸ

#### 3. æ’­æ”¾æ§åˆ¶

**åŸºç¡€æ§åˆ¶ï¼š**
- æ’­æ”¾/æš‚åœ
- éŸ³é‡è°ƒèŠ‚
- å…¨å±åˆ‡æ¢

**å›çœ‹ç‰¹æœ‰ï¼š**
- è¿›åº¦æ¡æ‹–åŠ¨ï¼ˆè·³è½¬åˆ°èŠ‚ç›®å†…ä»»æ„æ—¶é—´ç‚¹ï¼‰
- å¿«è¿›/å¿«é€€ 10 ç§’
- è¿”å›ç›´æ’­æŒ‰é’®
- è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ªèŠ‚ç›®

### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [è¿”å›] CCTV1          [è®¾ç½®] [æ”¶è—]    â”‚  é¡¶éƒ¨å·¥å…·æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚          è§†é¢‘æ’­æ”¾åŒºåŸŸ                    â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”´ ç›´æ’­ä¸­ | ğŸ“º å›çœ‹                     â”‚  æ¨¡å¼åˆ‡æ¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–°é—»è”æ’­                                â”‚  èŠ‚ç›®ä¿¡æ¯
â”‚  19:00 - 19:30 (30åˆ†é’Ÿ)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â—€ 2æœˆ27æ—¥ | 2æœˆ28æ—¥ | 2æœˆ29æ—¥ â–¶        â”‚  æ—¥æœŸé€‰æ‹©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ—¶é—´è½´æ»šåŠ¨åŒºåŸŸ]                        â”‚
â”‚  06:00  09:00  12:00  15:00  18:00     â”‚
â”‚  â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤      â”‚
â”‚  â”‚æ—©é—´â”‚  â”‚åˆé—´â”‚  â”‚  â”‚æ–°é—»â”‚  â”‚  â”‚       â”‚
â”‚         â–² å½“å‰æ—¶é—´                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [èŠ‚ç›®åˆ—è¡¨]                              â”‚
â”‚  âœ“ 19:00-19:30 æ–°é—»è”æ’­ (æ­£åœ¨æ’­æ”¾)      â”‚
â”‚    18:00-19:00 ç»¼åˆæ–°é—»                 â”‚
â”‚    17:00-18:00 ä»Šæ—¥è¯´æ³•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰‹åŠ¿å’Œå¿«æ·é”®

**ç§»åŠ¨ç«¯/å¹³æ¿ï¼š**
- å•å‡»ï¼šæ˜¾ç¤º/éšè—æ§åˆ¶æ 
- åŒå‡»ï¼šæ’­æ”¾/æš‚åœ
- å·¦å³æ»‘åŠ¨ï¼šå¿«é€€/å¿«è¿›
- ä¸Šä¸‹æ»‘åŠ¨ï¼ˆå·¦ï¼‰ï¼šäº®åº¦
- ä¸Šä¸‹æ»‘åŠ¨ï¼ˆå³ï¼‰ï¼šéŸ³é‡

**TV é¥æ§å™¨ï¼š**
- OKï¼šæ’­æ”¾/æš‚åœ
- è¿”å›ï¼šé€€å‡ºæˆ–è¿”å›ç›´æ’­
- å·¦å³ï¼šå¿«é€€/å¿«è¿›æˆ–åˆ‡æ¢èŠ‚ç›®
- ä¸Šä¸‹ï¼šéŸ³é‡æˆ–æµè§ˆåˆ—è¡¨

**æ¡Œé¢é”®ç›˜ï¼š**
- ç©ºæ ¼ï¼šæ’­æ”¾/æš‚åœ
- â†/â†’ï¼šå¿«é€€/å¿«è¿›
- â†‘/â†“ï¼šéŸ³é‡
- Fï¼šå…¨å±
- Lï¼šè¿”å›ç›´æ’­
- Mï¼šé™éŸ³

### æ™ºèƒ½åŠŸèƒ½

1. **è®°å¿†æ’­æ”¾ä½ç½®**
   - è®°å½•ä¸Šæ¬¡è§‚çœ‹ä½ç½®
   - æç¤º"ç»§ç»­æ’­æ”¾"æˆ–"ä»å¤´æ’­æ”¾"

2. **è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ª**
   - èŠ‚ç›®ç»“æŸåè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ª
   - 5 ç§’å€’è®¡æ—¶æç¤º
   - å¯å–æ¶ˆ

3. **æ¨èç›¸å…³èŠ‚ç›®**
   - æ ¹æ®è§‚çœ‹å†å²æ¨è
   - æ˜¾ç¤ºåŒæ—¶æ®µå…¶ä»–é¢‘é“èŠ‚ç›®

---

## æŠ€æœ¯å®ç°è¦ç‚¹

### M3U è§£æä¼˜å…ˆçº§
```
å•ä¸ªé¢‘é“é…ç½® > å…¨å±€é…ç½® > é»˜è®¤å€¼
```

### URL æ„å»ºç¤ºä¾‹

**Append æ¨¡å¼ï¼š**
```
åŸå§‹: http://server.com/stream.m3u8
æ¨¡æ¿: ?playseek=${(b)yyyyMMddHHmmss}-${(e)yyyyMMddHHmmss}
ç»“æœ: http://server.com/stream.m3u8?playseek=20260228190000-20260228193000
```

**Default æ¨¡å¼ï¼š**
```
åŸå§‹: http://server.com/stream.m3u8
æ¨¡æ¿: http://archive.com/vod?start=${(b)timestamp}&end=${(e)timestamp}
ç»“æœ: http://archive.com/vod?start=1709143200&end=1709145000
```

### æ—¶é—´å¤„ç†
```dart
// èŠ‚ç›®å¼€å§‹æ—¶é—´ï¼š2026-02-28 19:00:00
// èŠ‚ç›®ç»“æŸæ—¶é—´ï¼š2026-02-28 19:30:00

// æœ¬åœ°æ—¶é—´æ ¼å¼
${(b)yyyyMMddHHmmss} â†’ 20260228190000
${(e)yyyyMMddHHmmss} â†’ 20260228193000

// UTC æ—¶é—´æ ¼å¼ï¼ˆå‡è®¾ UTC+8ï¼‰
${(b)yyyyMMddHHmmss:utc} â†’ 20260228110000
${(e)yyyyMMddHHmmss:utc} â†’ 20260228113000

// Unix æ—¶é—´æˆ³
${(b)timestamp} â†’ 1709143200
${(e)timestamp} â†’ 1709145000
```

---

## å®æ–½å»ºè®®

### é˜¶æ®µ 1ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆ2-3 å‘¨ï¼‰
- M3U è§£æå¢å¼ºï¼ˆå…¨å±€ + å•ä¸ªé¢‘é“é…ç½®ï¼‰
- æ•°æ®æ¨¡å‹è®¾è®¡
- URL æ„å»ºå™¨å®ç°

### é˜¶æ®µ 2ï¼šEPG é›†æˆï¼ˆ2 å‘¨ï¼‰
- XMLTV è§£æ
- æ•°æ®åº“å­˜å‚¨
- èŠ‚ç›®æ•°æ®åŒæ­¥

### é˜¶æ®µ 3ï¼šUI å®ç°ï¼ˆ2-3 å‘¨ï¼‰
- æ—¶é—´è½´ç»„ä»¶
- èŠ‚ç›®åˆ—è¡¨
- æ’­æ”¾å™¨æ§åˆ¶å¢å¼º

### é˜¶æ®µ 4ï¼šäº¤äº’ä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰
- æ‰‹åŠ¿æ”¯æŒ
- å¿«æ·é”®
- æ™ºèƒ½åŠŸèƒ½

### é˜¶æ®µ 5ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2 å‘¨ï¼‰
- å…¼å®¹æ€§æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- Bug ä¿®å¤

**æ€»è®¡ï¼š8-12 å‘¨**

---

## å‚è€ƒæ–‡æ¡£

- å®Œæ•´è®¾è®¡æ–‡æ¡£ï¼š`docs/catchup_feature_design.md`
- ç¬¬ 2 èŠ‚ï¼šM3U Catchup æ ‡å‡†ï¼ˆæ‰€æœ‰é…ç½®æ–¹å¼ï¼‰
- ç¬¬ 5.4 èŠ‚ï¼šæ’­æ”¾é¡µé¢äº¤äº’è¯¦ç»†è®¾è®¡
- ç¬¬ 7 èŠ‚ï¼šæŠ€æœ¯å®ç°è¦ç‚¹
- ç¬¬ 11 èŠ‚ï¼šå®æ–½è®¡åˆ’
